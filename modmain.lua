GetPlayer = GLOBAL.GetPlayer

--These give names to all of the new things.

local STRINGS = GLOBAL.STRINGS

GLOBAL.STRINGS.NAMES.SHOPKEEPER = "Shopkeeper"

GLOBAL.STRINGS.NAMES.DATURA = "Datura"
GLOBAL.STRINGS.NAMES.DATURA_PETALS = "Datura Petals"

GLOBAL.STRINGS.NAMES.CRYSTAL_DEPOSIT = "Crystal Deposit"
GLOBAL.STRINGS.NAMES.CRYSTAL_SHARD = "Crystal Shard"
GLOBAL.STRINGS.NAMES.CRYSTAL_MOSS = "Crystal Moss"
GLOBAL.STRINGS.NAMES.CRYSTAL_WALL = "Crystal Wall"
GLOBAL.STRINGS.NAMES.CRYSTAL_CAP = "Crystal Cap"
GLOBAL.STRINGS.NAMES.CRYSTAL_LAMP = "Crystal Lamp"

GLOBAL.STRINGS.NAMES.SUNFLOWER = "Golden Sunflower"
GLOBAL.STRINGS.NAMES.SUNFLOWER_SEEDS = "Golden Sunflower Seeds"

GLOBAL.STRINGS.NAMES.MOONFLOWER = "Moonflower"
GLOBAL.STRINGS.NAMES.MOONFLOWER_SEEDS = "Moonflower Seeds"

GLOBAL.STRINGS.NAMES.YELLOW_MUSHROOM = "Yellow Mushroom"
GLOBAL.STRINGS.NAMES.YELLOW_CAP = "Yellow Cap"
GLOBAL.STRINGS.NAMES.YELLOW_CAP_COOKED = "Cooked Yellow Cap"

GLOBAL.STRINGS.NAMES.ORANGE_MUSHROOM = "Orange Mushroom"
GLOBAL.STRINGS.NAMES.ORANGE_CAP = "Orange Cap"
GLOBAL.STRINGS.NAMES.ORANGE_CAP_COOKED = "Cooked Orange Cap"

GLOBAL.STRINGS.NAMES.PURPLE_MUSHROOM = "Purple Mushroom"
GLOBAL.STRINGS.NAMES.PURPLE_CAP = "Purple Cap"
GLOBAL.STRINGS.NAMES.PURPLE_CAP_COOKED = "Cooked Purple Cap"

GLOBAL.STRINGS.NAMES.BEANSTALK = "Beanstalk"
GLOBAL.STRINGS.NAMES.BEANSTALK_EXIT = "Beanstalk"
GLOBAL.STRINGS.NAMES.BEANSTALK_WALL = "Beanstalk Wall"
GLOBAL.STRINGS.NAMES.BEANSTALK_CHUNK = "Beanstalk Chunk"

GLOBAL.STRINGS.NAMES.MAGIC_BEANS = "Magic Beans"
GLOBAL.STRINGS.NAMES.MAGIC_BEAN_SPROUT = "Bean Sprout"
GLOBAL.STRINGS.NAMES.MAGIC_BEAN_GIANT = "Bean Giant"

GLOBAL.STRINGS.NAMES.CLOUD_FLUFF = "Cloud"
GLOBAL.STRINGS.NAMES.CLOUD_FLUFF = "Cloud Fluff"
GLOBAL.STRINGS.NAMES.CLOUD_BOMB = "Cloud Bomb"
GLOBAL.STRINGS.NAMES.CLOUD_STORAGE = "Cloud Chest"
GLOBAL.STRINGS.NAMES.CLOUD_TURF = "Cloud Turf"

GLOBAL.STRINGS.NAMES.CUSHION_PLANT = "Cloud Bush"
GLOBAL.STRINGS.NAMES.CUSHION_FRUIT = "Cloud Fruit"

GLOBAL.STRINGS.NAMES.PINEAPPLE_BUSH = "Pineapple Bush"
GLOBAL.STRINGS.NAMES.PINEAPPLE_FRUIT = "Pineapple"

GLOBAL.STRINGS.NAMES.GOLDEN_EGG = "Golden Egg"
GLOBAL.STRINGS.NAMES.GOLDEN_AMULET = "Golden Amulet"
GLOBAL.STRINGS.NAMES.GOLDEN_GOLEM = "Golden Golem"

GLOBAL.STRINGS.NAMES.MONOLITH = "Monolith"

GLOBAL.STRINGS.NAMES.RESEARCH_LECTERN = "Research Lectern"

GLOBAL.STRINGS.NAMES.WIND_AXE = "Wind Axe"

GLOBAL.STRINGS.NAMES.KITE = "Kite"

GLOBAL.STRINGS.NAMES.DUCKRAPTOR = "Duckraptor"
GLOBAL.STRINGS.NAMES.DUCKRAPTOR_MOTHER = "Mother Duckraptor"
GLOBAL.STRINGS.NAMES.DUCKRAPTOR_BABY = "Duckling"

GLOBAL.STRINGS.NAMES.LIONANT = "Lionant"

--These are descriptions for the new things.

--For the beanstalk.
STRINGS.CHARACTERS.GENERIC.DESCRIBE.BEANSTALK = "It reaches the clouds."
STRINGS.CHARACTERS.WILLOW.DESCRIBE.BEANSTALK = "That would make a spectacular fire."
STRINGS.CHARACTERS.WENDY.DESCRIBE.BEANSTALK = "All I'd need to do is let go."
STRINGS.CHARACTERS.WOLFGANG.DESCRIBE.BEANSTALK = "Is big beanstalk. Reminds Wolfgang of home."
STRINGS.CHARACTERS.WX78.DESCRIBE.BEANSTALK = "IT HAS GROWN OUT OF CONTROL."
STRINGS.CHARACTERS.WICKERBOTTOM.DESCRIBE.BEANSTALK = "The end of the stalk is covered by a layer of cumulonimbus clouds."
STRINGS.CHARACTERS.WOODIE.DESCRIBE.BEANSTALK = "Even Lucy can't chop through it."
STRINGS.CHARACTERS.WAXWELL.DESCRIBE.BEANSTALK = "Some things were too big to fit in the caves. "

--For the shopkeeper.
STRINGS.CHARACTERS.GENERIC.DESCRIBE.SHOPKEEPER = "Odd place to set up a store."
STRINGS.CHARACTERS.WILLOW.DESCRIBE.SHOPKEEPER = "I like the flag on his umbrella."
STRINGS.CHARACTERS.WENDY.DESCRIBE.SHOPKEEPER = "A deceiver at heart."
STRINGS.CHARACTERS.WOLFGANG.DESCRIBE.SHOPKEEPER = "He sells no potatoes."
STRINGS.CHARACTERS.WX78.DESCRIBE.SHOPKEEPER = "A PEDDLER OF GOODS."
STRINGS.CHARACTERS.WICKERBOTTOM.DESCRIBE.SHOPKEEPER = "Perhaps he has some books for sale."
STRINGS.CHARACTERS.WOODIE.DESCRIBE.SHOPKEEPER = "Men like this ran my lumber yard."
STRINGS.CHARACTERS.WAXWELL.DESCRIBE.SHOPKEEPER = "I thought I got rid of you."

--These assets are for all of the added inventory items.

Assets = {

	--Asset( "ATLAS", "images/inventoryimages/datura_petals.xml" ),
	--Asset( "IMAGE", "images/inventoryimages/datura_petals.tex" ),
	
	--Asset( "ATLAS", "images/inventoryimages/crystal_shard.xml" ),
	--Asset( "IMAGE", "images/inventoryimages/crystal_shard.tex" ),

	--Asset( "ATLAS", "images/inventoryimages/crystal_moss.xml" ),
	--Asset( "IMAGE", "images/inventoryimages/crystal_moss.tex" ),

	--Asset( "ATLAS", "images/inventoryimages/crystal_wall.xml" ),
	--Asset( "IMAGE", "images/inventoryimages/crystal_wall.tex" ),

	--Asset( "ATLAS", "images/inventoryimages/crystal_cap.xml" ),
	--Asset( "IMAGE", "images/inventoryimages/crystal_cap.tex" ),

	--Asset( "ATLAS", "images/inventoryimages/sunflower_seeds.xml" ),
	--Asset( "IMAGE", "images/inventoryimages/sunflower_seeds.tex" ),

	--Asset( "ATLAS", "images/inventoryimages/moonflower_seeds.xml" ),
	--Asset( "IMAGE", "images/inventoryimages/moonflower_seeds.tex" ),

	--Asset( "ATLAS", "images/inventoryimages/yellow_cap.xml" ),
	--Asset( "IMAGE", "images/inventoryimages/yellow_cap.tex" ),

	--Asset( "ATLAS", "images/inventoryimages/orange_cap.xml" ),
	--Asset( "IMAGE", "images/inventoryimages/orange_cap.tex" ),

	--Asset( "ATLAS", "images/inventoryimages/purple_cap.xml" ),
	--Asset( "IMAGE", "images/inventoryimages/purple_cap.tex" ),

	--Asset( "ATLAS", "images/inventoryimages/yellow_cap_cooked.xml" ),
	--Asset( "IMAGE", "images/inventoryimages/yellow_cap_cooked.tex" ),

	--Asset( "ATLAS", "images/inventoryimages/orange_cap_cooked.xml" ),
	--Asset( "IMAGE", "images/inventoryimages/orange_cap_cooked.tex" ),

	--Asset( "ATLAS", "images/inventoryimages/purple_cap_cooked.xml" ),
	--Asset( "IMAGE", "images/inventoryimages/purple_cap_cooked.tex" ),
	
	--Asset( "ATLAS", "images/inventoryimages/beanstalk_wall.xml" ),
	--Asset( "IMAGE", "images/inventoryimages/beanstalk_wall.tex" ),

	Asset( "ATLAS", "images/inventoryimages/beanstalk_chunk.xml" ),
	Asset( "IMAGE", "images/inventoryimages/beanstalk_chunk.tex" ),

	Asset( "ATLAS", "images/inventoryimages/magic_beans.xml" ),
	Asset( "IMAGE", "images/inventoryimages/magic_beans.tex" ),

	--Asset( "ATLAS", "images/inventoryimages/cloud_fluff.xml" ),
	--Asset( "IMAGE", "images/inventoryimages/cloud_fluff.tex" ),

	Asset( "ATLAS", "images/inventoryimages/golden_egg.xml" ),
	Asset( "IMAGE", "images/inventoryimages/golden_egg.tex" ),

	--Asset( "ATLAS", "images/inventoryimages/pineapple_fruit.xml" ),
	--Asset( "IMAGE", "images/inventoryimages/pineapple_fruit.tex" ),

	--Asset( "ATLAS", "images/inventoryimages/cushion_fruit.xml" ),
	--Asset( "IMAGE", "images/inventoryimages/cushion_fruit.tex" ),

	--Asset( "ATLAS", "images/inventoryimages/wind_axe.xml" ),
	--Asset( "IMAGE", "images/inventoryimages/wind_axe.tex" ),

	--Asset( "ATLAS", "images/inventoryimages/golden_amulet.xml" ),
	--Asset( "IMAGE", "images/inventoryimages/golden_amulet.tex" ),

	--Asset( "ATLAS", "images/inventoryimages/kite.xml" ),
	--Asset( "IMAGE", "images/inventoryimages/kite.tex" ),	
}

--This loads all of the new prefabs.

PrefabFiles = {
    "shopkeeper",

	--"datura",
	--"datura_petals",	
	--"crystal_deposit",
	--"crystal_shard",
	--"crystal_moss",
	--"crystal_wall",	
	--"crystal_cap",
	--"crystal_lamp",	
	--"sunflower",
	--"sunflower_seeds",
	--"moonflower",
	--"moonflower_seeds",	
	
	"new_mushrooms",
	"beanstalk",
	"beanstalk_exit",
	
	--"beanstalk_wall",	
	
	"beanstalk_chunk",	
	"magic_beans",	
	
	--"magic_bean_sprout",	
	--"magic_bean_giant",
	--"cloud_rock",
	--"cloud_fluff",	
	--"cloud_bomb",	
	--"cloud_storage",	
	
	"cloud_turf",	
	
	--"cushion_plant",
	--"cushion_fruit",	
	--"pineapple_bush",
	--"pineapple_fruit",
	
	"golden_egg",
	
	--"golden_amulet",
	--"golden_golem",
	--"monolith",
	--"research_lectern",
	--"wind_axe",
	--"kite",
	--"duckraptor",
	--"duckraptor_mother",	
	--"duckraptor_baby",		
	--"lionant",	
}

local prefabs = {

}



local function evergreens_ret(inst)
	inst:AddTag"evergreen_ret"
	
	if GetPlayer().goneUp == true then
		print "Testing goneUp."
	end	
	
end

local function onUp(inst)

		SetHUDPause(true)
		--Define the new world objects we are placing.
		local beanstalk = SpawnPrefab("beanstalk")

		--Define the old world objects we are replacing.
		local evergreens_ret = TheSim:FindFirstEntityWithTag("evergreen_ret")
		
		--Make sure that the player climbed the beanstalk.
		if GetPlayer().goneUp == true and GetPlayer().goneUpRemember == false then
			
			--Place the new world objects.			
			beanstalk.Transform:SetPosition(evergreens_ret.Transform:GetWorldPosition())
			
			--Remove the old world objects.
			evergreens_ret:Remove()
		end	
		
		SetHUDPause(false)
		GetPlayer().goneUpRemember = true
end

AddPrefabPostInit('evergreen', evergreens_ret)	 

--Changes "activate" to "talk to" for "shopkeeper".
AddSimPostInit(function(inst)
	local oldactionstringoverride = inst.ActionStringOverride
	function inst:ActionStringOverride(bufaction)
		if bufaction.action == GLOBAL.ACTIONS.ACTIVATE and bufaction.target and bufaction.target.prefab == "shopkeeper" then
			return "Talk to"
		end
		if oldactionstringoverride then
			return oldactionstringoverride(inst, bufaction)
		end
	end
end)

--Changes "activate" to "climb down" for "beanstalk_exit".
AddSimPostInit(function(inst)
	local oldactionstringoverride = inst.ActionStringOverride
	function inst:ActionStringOverride(bufaction)
		if bufaction.action == GLOBAL.ACTIONS.ACTIVATE and bufaction.target and bufaction.target.prefab == "beanstalk_exit" then
			return "Climb down"
		end
		if oldactionstringoverride then
			return oldactionstringoverride(inst, bufaction)
		end
	end
end)

--[[This is messy mess of ideas.

inst.task = inst:DoPeriodicTask(1, function() onUp(inst, owner) end)

if inst.task then inst.task:Cancel() inst.task = nil end

GetPlayer():ListenForEvent("goneUp", function(inst,data) onsacrifice(data.victim) end )

mushrooms
berrybush
evergreen
spikytree
spikybush
rocks

--]]
